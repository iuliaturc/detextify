# Detextify
A Python library to remove unwanted pseudo-text from images generated by AI.

| Before                      | After                                  |
|-----------------------------|----------------------------------------|
| ![before](data/octopus.png) | ![after](data/octopus_detextified.png) |

`Detextify` runs text detection on your image, masks the text boxes, and repeatedly in-paints the masked regions
until your image is text-free. `Detextify` can be run entirely on your local machine (using
[Paddle](https://github.com/PaddlePaddle/PaddleOCR) for text detection and
[Diffusers](https://huggingface.co/stabilityai/stable-diffusion-2-inpainting) for in-painting), or call existing APIs
([Azure](https://azure.microsoft.com/en-us/products/cognitive-services/computer-vision/) for text detection and
[OpenAI](https://openai.com/dall-e-2/) or [Replicate](https://replicate.com/) for in-painting).

## Installation
```commandline
pip install detextify
```

## Sample Usage
TODO: Link to Colab notebook.

The pipeline requires two main objects to be instantiated: a text detector and an in-painter.
### 1) Using local models
```python
from text_detector import PaddleTextDetector
from inpainter import DiffusersSDInpainter

text_detector = PaddleTextDetector()
inpainter = DiffusersSDInpainter()
```
Note that, if you already have a Stable Diffusion in-painting model instantiated in your code, you can pass a reference
to it:
```python
inpainter = DiffusersSDInpainter(my_sd_instance)
```

### 2) Calling external APIs
- For text detection, the library supports calls to Azure. You will first need to create a
[Computer Vision resource](https://portal.azure.com/#create/Microsoft.CognitiveServicesComputerVision) via the Azure
portal. Once created, take note of the endpoint (which is a URL like `https://detextify-cv.cognitiveservices.azure.com`)
and the key.
- For in-painting, we support calls to [Replicate](https://replicate.com) and [OpenAI](https://labs.openai.com); both
of these require keys.

```python
from text_detector import AzureTextDetector
from inpainter import DalleInpainter, ReplicateInpainter

AZURE_CV_ENDPOINT = "..."
AZURE_CV_KEY = "..."
OPENAI_KEY = "..."  # or REPLICATE_KEY = "..."

INPUT_IMAGE = "/input/image/path.png"
OUTPUT_IMAGE = "/output/image/path.png"

text_detector = AzureTextDetector(AZURE_CV_ENDPOINT, AZURE_CV_KEY)
inpainter = DalleInpainter(OPENAI_KEY)  # or ReplicateInpainter(REPLICATE_KEY)
```
Finally, after defining a text detector and an inpainter, you can call the de-textifier:
```python
from detextifier import Detextifier

detextifier = Detextifier(text_detector, inpainter)
detextifier.detextify("/my/input/image/path.png", "/my/output/image/path.png")
```

## Contributing
To contribute, clone the repository, make your changes, commit and push to your clone, and submit a pull request.

To build the library, you need to install [poetry](https://python-poetry.org/):
```commandline
curl -sSL https://install.python-poetry.org | python3 -
# Add poetry to your PATH. Note the specific path will differ depending on your system.
export PATH="/home/ubuntu/.local/bin:$PATH"
# Check the installation was successful:
poetry --version
```
Install dependencies for `detextify`:
```commandline
poetry install
```
To execute a script, run:
```commandline
poetry run python your_script.py
```
Please run the unit tests to make sure that your changes are not breaking the codebase:
```commandline
poetry run pytest
```

## Authors
This project was authored by [Mihail Eric](https://twitter.com/mihail_eric) and [Julia Turc](https://twitter.com/juliarturc). If you are building in the generative AI space, we want to hear from you!
